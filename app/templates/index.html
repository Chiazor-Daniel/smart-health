<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Health Advisor</title>
    <!-- Modern Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Chat Window Styling */
.chat-messages {
    height: 400px !important;
    overflow-y: auto !important;
    scroll-behavior: smooth !important;
    padding: 20px !important;
    background: #f8f9fa !important;
}

/* Message Bubbles */
.chat-messages .message {
    display: flex !important;
    margin-bottom: 15px !important;
    animation: fadeIn 0.3s ease-out !important;
    width: 100% !important;
    clear: both !important;
}

.chat-messages .bot-message {
    justify-content: flex-start !important;
}

.chat-messages .user-message {
    justify-content: flex-end !important;
}

.chat-messages .message-content {
    max-width: 70% !important;
    padding: 12px 16px !important;
    border-radius: 15px !important;
    position: relative !important;
    word-wrap: break-word !important;
    display: inline-block !important;
}

.chat-messages .bot-message .message-content {
    background: white !important;
    margin-right: 50px !important;
    border-bottom-left-radius: 5px !important;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1) !important;
    color: #212529 !important;
    text-align: left !important;
}

.chat-messages .user-message .message-content {
    background: #0d6efd !important;
    color: white !important;
    margin-left: 50px !important;
    border-bottom-right-radius: 5px !important;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1) !important;
    text-align: left !important;
}

/* Loading Animation */
.typing-indicator {
    display: flex !important;
    align-items: center !important;
    margin: 15px !important;
    height: 30px !important;
    position: relative !important;
    background: transparent !important;
}

.typing-dot {
    width: 8px !important;
    height: 8px !important;
    margin: 0 2px !important;
    background-color: #90949c !important;
    border-radius: 50% !important;
    display: inline-block !important;
    animation: typing 1.4s infinite ease-in-out !important;
}

.typing-dot:nth-child(1) { animation-delay: 200ms !important; }
.typing-dot:nth-child(2) { animation-delay: 300ms !important; }
.typing-dot:nth-child(3) { animation-delay: 400ms !important; }

@keyframes typing {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Input Area */
.chat-input-area {
    background: #f8f9fa !important;
    border-top: 1px solid #dee2e6 !important;
    padding: 15px !important;
    position: relative !important;
}

.chat-input-area .form-control {
    border: 1px solid #dee2e6 !important;
    border-radius: 20px !important;
    padding: 10px 15px !important;
}

.chat-input-area .btn-primary {
    border-radius: 20px !important;
}

/* Card Styling */
.card {
    border-radius: 15px !important;
    overflow: hidden !important;
}

/* Hide Loading by Default */
.d-none {
    display: none !important;
}
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <!-- Header -->
        <div class="header text-center mb-4">
            <h1 class="display-4 text-primary">
                <i class="fas fa-heartbeat me-2"></i>Smart Health Advisor
            </h1>
            <p class="lead text-muted">Your Personal Health Assistant</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-8">
                <!-- Chat Window -->
                <div class="card shadow-sm">
                    <div class="card-body p-0">
                        <!-- Chat Messages -->
                        <div id="chat-box" class="chat-messages">
                            <!-- Welcome message -->
                            <div class="message bot-message">
                                <div class="message-content">
                                    <i class="fas fa-robot me-2"></i>
                                    Hello! I'm your health advisor. How can I help you today?
                                </div>
                            </div>
                        </div>
                        
                        <!-- Loading indicator -->
                        <div id="typing" class="typing-indicator d-none">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                        </div>

                        <!-- Input Area -->
                        <div class="chat-input-area">
                            <form id="chat-form" class="d-flex gap-2">
                                <div class="input-group">
                                    <input type="text" 
                                           id="user-input" 
                                           class="form-control" 
                                           placeholder="Type your health question..."
                                           autocomplete="off">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const chatForm = document.getElementById('chat-form');
        const typingIndicator = document.getElementById('typing');

        // Function to add a message to the chat
        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            if (!isUser) {
                messageContent.innerHTML = `<i class="fas fa-robot me-2"></i>${message}`;
            } else {
                messageContent.textContent = message;
            }
            
            messageDiv.appendChild(messageContent);
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Show/hide typing indicator
        function setTyping(isTyping) {
            typingIndicator.classList.toggle('d-none', !isTyping);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Handle form submission
        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const message = userInput.value.trim();
            
            if (!message) return;
            
            // Add user message and clear input
            addMessage(message, true);
            userInput.value = '';
            
            // Show typing indicator
            setTyping(true);

            try {
                // Send message to backend
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                
                // Hide typing indicator and add response
                setTyping(false);
                addMessage(data.response);
                
            } catch (error) {
                setTyping(false);
                addMessage('Sorry, I encountered an error. Please try again.');
            }
        });

        // Enter key to submit
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>